<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŠ¸ë˜í”½ ë“±ê¸‰ ê²°ê³¼</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .eco-badge {
            background: #e8f5e9;
            border-radius: 25px;
            padding: 10px 20px;
            display: inline-block;
            color: #2e7d32;
            border: 1px solid #2e7d32;
        }
        .carbon-metric {
            text-align: center;
            margin: 20px 0;
        }
        .carbon-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-md-8">
                <h1 class="text-center mb-4">íŠ¸ë˜í”½ ë“±ê¸‰ ê²°ê³¼</h1>
                
                <!-- ë“±ê¸‰ í‘œì‹œ -->
                <div class="mt-4">
                    <h3 id="grade" class="text-center">ë“±ê¸‰: {{ grade }}</h3>
                    <div class="progress mt-4">
                        <div id="gradeBar" class="progress-bar" role="progressbar"></div>
                    </div>
                </div>

                <!-- íƒ„ì†Œ ë°°ì¶œëŸ‰ ì‹œê°í™” -->
                <div class="row mt-5">
                    <div class="col-md-3 carbon-metric">
                        <div class="carbon-icon">â˜•</div>
                        <p>ì»¤í”¼ 2ì” ë¶„ëŸ‰ì˜<br>íƒ„ì†Œ ë°°ì¶œëŸ‰</p>
                    </div>
                    <div class="col-md-3 carbon-metric">
                        <div class="carbon-icon">ğŸš—</div>
                        <p>ìë™ì°¨ 2km ì£¼í–‰<br>ë°°ì¶œëŸ‰ê³¼ ë™ì¼</p>
                    </div>
                    <div class="col-md-3 carbon-metric">
                        <div class="carbon-icon">ğŸ“±</div>
                        <p>ìŠ¤ë§ˆíŠ¸í° 4ì‹œê°„<br>ì¶©ì „ëŸ‰ê³¼ ë™ì¼</p>
                    </div>
                    <div class="col-md-3 carbon-metric">
                        <div class="carbon-icon">ğŸŒ³</div>
                        <p>ë‚˜ë¬´ 1ê·¸ë£¨ì˜<br>2ì¼ í¡ìˆ˜ëŸ‰</p>
                    </div>
                </div>

                <!-- ê¸°ì¡´ íƒ„ì†Œ ë°°ì¶œëŸ‰ ì‹œê°í™” SVG ë¶€ë¶„ì„ ìˆ˜ì • -->
                <div class="mt-5">
                    <h4>íƒ„ì†Œ ë°°ì¶œëŸ‰ ë¶„í¬</h4>
                    <svg id="histogram" width="800" height="300"></svg>
                </div>

                <!-- ìƒˆë¡œìš´ ë©€í‹°ë¼ì¸ ê·¸ë˜í”„ ì¶”ê°€ -->
                <div class="mt-5">
                    <h4>ê³µê³µê¸°ê´€ íƒ„ì†Œë°°ì¶œëŸ‰ ì¶”ì´</h4>
                    <svg id="multiline" width="800" height="400"></svg>
                </div>


                <!-- ì§€ì†ê°€ëŠ¥í•œ ì›¹ê°œë°œ ê°€ì´ë“œë¼ì¸ -->
                <div class="mt-5">
                    <h4>ì§€ì†ê°€ëŠ¥í•œ ì›¹ê°œë°œ ê°€ì´ë“œë¼ì¸ ì¤€ìˆ˜ í˜„í™©</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ë²ˆí˜¸</th>
                                <th>í•­ëª©</th>
                                <th>ì¤€ìˆ˜ì—¬ë¶€</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>ì´ë¯¸ì§€ ìµœì í™”</td>
                                <td>âœ…</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>ìºì‹œ í™œìš©</td>
                                <td>âŒ</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>ë¶ˆí•„ìš”í•œ ìŠ¤í¬ë¦½íŠ¸ ì œê±°</td>
                                <td>âœ…</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

<!-- Google Lighthouse ìƒì„¸ ë³´ê³ ì„œ -->
<div class="container mt-5">
    <h4>Google Lighthouse ìƒì„¸ ë¶„ì„ ê²°ê³¼</h4>
    <div class="table-responsive">
        <table class="table table-bordered">
            <thead class="thead-light">
                <tr>
                    <th>ë¶„ì„ í•­ëª©</th>
                    <th>ì ˆê° ê°€ëŠ¥ ìš©ëŸ‰</th>
                    <th>ìƒì„¸ ë‚´ìš©</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>ë¯¸ì‚¬ìš© JavaScript</td>
                    <td>{{ unused_javascript.details.overallSavingsBytes | default(0) | filesizeformat }}</td>
                    <td>ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” JavaScript ì½”ë“œ ì œê±°</td>
                </tr>
                <tr>
                    <td>ë¯¸ì‚¬ìš© CSS</td>
                    <td>{{ unused_css_rules.details.overallSavingsBytes | default(0) | filesizeformat }}</td>
                    <td>ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” CSS ê·œì¹™ ì œê±°</td>
                </tr>
                <tr>
                    <td>ì´ë¯¸ì§€ ìµœì í™”</td>
                    <td>{{ modern_image_formats.details.overallSavingsBytes | default(0) | filesizeformat }}</td>
                    <td>WebP/AVIF ë“± ìµœì‹  ì´ë¯¸ì§€ í¬ë§· ì‚¬ìš©</td>
                </tr>
                <tr>
                    <td>ì• ë‹ˆë©”ì´ì…˜ ìµœì í™”</td>
                    <td>{{ efficient_animated_content.details.overallSavingsBytes | default(0) | filesizeformat }}</td>
                    <td>ì• ë‹ˆë©”ì´ì…˜ GIFë¥¼ ë™ì˜ìƒìœ¼ë¡œ ëŒ€ì²´</td>
                </tr>
                <tr>
                    <td>ì¤‘ë³µ JavaScript</td>
                    <td>{{ duplicated_javascript.details.overallSavingsBytes | default(0) | filesizeformat }}</td>
                    <td>ì¤‘ë³µëœ JavaScript ëª¨ë“ˆ í†µí•©</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


                <!-- ì—ì½”ì›¹ ë±ƒì§€ -->
                <div class="text-center mt-5">
                    <div class="eco-badge">
                        <span>125g of CO2</span>
                        <span>ECO-WEB</span>
                    </div>
                </div>

                <!-- ë¦¬ì†ŒìŠ¤ ì ˆê° í˜„í™© -->
                <div class="mt-5">
                    <h4>ìµœì í™” ì „/í›„ ë¹„êµ</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Before</h5>
                            <img src="{{ url_for('static', filename='screenshots/before.png') }}" alt="Before" class="image">
                            <p>ì´ ë¦¬ì†ŒìŠ¤: 3.3MB</p>
                        </div>
                        <div class="col-md-6">
                            <h5>After</h5>
                            <img src="{{ url_for('static', filename='screenshots/after.png') }}" alt="After" class="image">
                            <p>ì´ ë¦¬ì†ŒìŠ¤: 1.1MB</p>
                        </div>
                    </div>
                </div>
                <!-- ì¸ì¦ë§ˆí¬ ë°›ê¸° -->
                <div class="text-center mt-4">
                    <a href="/" class="btn btn-secondary">ë‹¤ì‹œ ì…ë ¥í•˜ê¸°</a>
                </div>
            </div>
        </div>
    </div>




    <script>
        // ê¸°ì¡´ ë“±ê¸‰ í‘œì‹œ ìŠ¤í¬ë¦½íŠ¸
        const grade = "{{ grade }}";
        const grades = ['A', 'B', 'C', 'D', 'E', 'F'];
        const gradeBar = document.getElementById('gradeBar');
        gradeBar.style.width = (grades.indexOf(grade) + 1) * 16.66 + '%';
        gradeBar.textContent = grade;

        switch (grade) {
            case 'A': gradeBar.classList.add('bg-success'); break;
            case 'B': gradeBar.classList.add('bg-info'); break;
            case 'C': gradeBar.classList.add('bg-primary'); break;
            case 'D': gradeBar.classList.add('bg-warning'); break;
            case 'E': gradeBar.classList.add('bg-orange'); break;
            case 'F': gradeBar.classList.add('bg-danger'); break;
        }

// ì˜ˆì‹œ ë°ì´í„° ìƒì„± (íŒŒì´ì¬ì—ì„œ ë§Œë“  ë°ì´í„°ì™€ ìœ ì‚¬í•˜ê²Œ)
const existingData = Array.from({length: 25000}, () => d3.randomNormal(500, 100)());

// ìƒˆë¡œìš´ URL ë°ì´í„°
const newUrlData = 550;

// SVG í¬ê¸° ì„¤ì •
const svg = d3.select("svg");
const margin = {top: 20, right: 20, bottom: 30, left: 40};
const width = +svg.attr("width") - margin.left - margin.right;
const height = +svg.attr("height") - margin.top - margin.bottom;
const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

// Xì¶• ë° Yì¶• ë²”ìœ„ ì„¤ì •
const x = d3.scaleLinear()
    .domain([d3.min(existingData), d3.max(existingData)])
    .rangeRound([0, width]);

const bins = d3.histogram()
    .domain(x.domain())
    .thresholds(x.ticks(50))
    (existingData);

const y = d3.scaleLinear()
    .domain([0, d3.max(bins, d => d.length)])
    .range([height, 0]);

// Xì¶•
g.append("g")
    .attr("class", "axis axis--x")
    .attr("transform", `translate(0,${height})`)
    .call(d3.axisBottom(x));

// Yì¶•
g.append("g")
    .attr("class", "axis axis--y")
    .call(d3.axisLeft(y));

// íˆìŠ¤í† ê·¸ë¨ ë§‰ëŒ€ ì¶”ê°€
g.selectAll(".bar")
    .data(bins)
    .enter().append("rect")
    .attr("class", "bar")
    .attr("x", d => x(d.x0))
    .attr("y", d => y(d.length))
    .attr("width", d => x(d.x1) - x(d.x0) - 1)
    .attr("height", d => height - y(d.length))
    .attr("fill", "steelblue");

// ìƒˆë¡œìš´ URL ë°ì´í„°ë¥¼ ì„ ìœ¼ë¡œ í‘œì‹œ
g.append("line")
    .attr("x1", x(newUrlData))
    .attr("x2", x(newUrlData))
    .attr("y1", 0)
    .attr("y2", height)
    .attr("stroke", "red")
    .attr("stroke-width", 2)
    .attr("stroke-dasharray", "4,4");


    // ê¸°ì¡´ íˆìŠ¤í† ê·¸ë¨ ì½”ë“œëŠ” ìœ ì§€í•˜ê³ , ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€

// ë©€í‹°ë¼ì¸ ê·¸ë˜í”„ ìƒì„±
const multilineSvg = d3.select("#multiline");
const multilineMargin = {top: 40, right: 80, bottom: 50, left: 60};
const multilineWidth = +multilineSvg.attr("width") - multilineMargin.left - multilineMargin.right;
const multilineHeight = +multilineSvg.attr("height") - multilineMargin.top - multilineMargin.bottom;

const multilineG = multilineSvg.append("g")
    .attr("transform", `translate(${multilineMargin.left},${multilineMargin.top})`);

// ê°€ìƒì˜ ë°ì´í„° ìƒì„± (ì‹¤ì œ ë°ì´í„°ë¡œ êµì²´ í•„ìš”)
const institutions = Array.from({length: 100}, (_, i) => i);
const carbonLevels = institutions.map(() => Math.random() * 100 + 50);
const guidelineCount = institutions.map(() => Math.random() * 30 + 10);
const lowCarbonAvg = institutions.map(() => 40 + Math.random() * 10); // ì €íƒ„ì†Œ í‰ê· ì€ 40~50 ì •ë„
const highlightIndex = 42; // í˜„ì¬ ë¶„ì„ ì¤‘ì¸ URLì˜ ì¸ë±ìŠ¤

// ìŠ¤ì¼€ì¼ ì„¤ì •
const multilineX = d3.scaleLinear()
    .domain([0, institutions.length - 1])
    .range([0, multilineWidth]);

const multilineY = d3.scaleLinear()
    .domain([0, d3.max([...carbonLevels, ...guidelineCount, ...lowCarbonAvg]) * 1.2])
    .range([multilineHeight, 0]);

// ë¼ì¸ ìƒì„±ê¸°
const line = d3.line()
    .x((d, i) => multilineX(i))
    .y(d => multilineY(d))
    .curve(d3.curveNatural);

// ê° ë¼ì¸ ê·¸ë¦¬ê¸°
multilineG.append("path")
    .datum(carbonLevels)
    .attr("class", "line")
    .style("stroke", "#ff0000")
    .style("fill", "none")
    .style("stroke-width", 2)
    .attr("d", line);

multilineG.append("path")
    .datum(guidelineCount)
    .attr("class", "line")
    .style("stroke", "#0000ff")
    .style("fill", "none")
    .style("stroke-width", 2)
    .attr("d", line);

multilineG.append("path")
    .datum(lowCarbonAvg)
    .attr("class", "line")
    .style("stroke", "#00ff00")
    .style("fill", "none")
    .style("stroke-width", 2)
    .attr("d", line);

// í•˜ì´ë¼ì´íŠ¸ í¬ì¸íŠ¸
multilineG.append("circle")
    .attr("cx", multilineX(highlightIndex))
    .attr("cy", multilineY(carbonLevels[highlightIndex]))
    .attr("r", 6)
    .style("fill", "#800080");

// ì¶• ì¶”ê°€
multilineG.append("g")
    .attr("transform", `translate(0,${multilineHeight})`)
    .call(d3.axisBottom(multilineX).ticks(10))
    .append("text")
    .attr("x", multilineWidth / 2)
    .attr("y", 40)
    .attr("fill", "black")
    .text("ê³µê³µê¸°ê´€");

multilineG.append("g")
    .call(d3.axisLeft(multilineY))
    .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", -50)
    .attr("x", -multilineHeight / 2)
    .attr("fill", "black")
    .attr("text-anchor", "middle")
    .text("íƒ„ì†Œë°°ì¶œëŸ‰");

// ë²”ë¡€ ì¶”ê°€
const legend = multilineG.append("g")
    .attr("font-family", "sans-serif")
    .attr("font-size", 10)
    .attr("text-anchor", "start")
    .attr("transform", `translate(${multilineWidth + 10},0)`);

const legendItems = [
    {color: "#ff0000", text: "íƒ„ì†ŒëŸ‰"},
    {color: "#0000ff", text: "ê°€ì´ë“œë¼ì¸ ì¤€ìˆ˜"},
    {color: "#00ff00", text: "ì €íƒ„ì†Œ í‰ê· "}
];

legendItems.forEach((item, i) => {
    const legendRow = legend.append("g")
        .attr("transform", `translate(0,${i * 20})`);
        
    legendRow.append("rect")
        .attr("width", 15)
        .attr("height", 2)
        .attr("fill", item.color);
        
    legendRow.append("text")
        .attr("x", 20)
        .attr("y", 5)
        .text(item.text);
});
    </script>
</body>
</html>